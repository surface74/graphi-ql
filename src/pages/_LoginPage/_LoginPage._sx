import { SubmitHandler, useForm } from 'react-hook-form';
import { useNavigate } from 'react-router-dom';
import styles from './style.module.scss';
import { yupResolver } from '@hookform/resolvers/yup';
import { schema } from '../../yup/schema';
// import { setUser } from '../../store/slices/userSlice';
import { Form } from '../../common-types/common-types';
import errorMessages from '../../assets/errorMessages.json';
import { useDataContext } from '../../DataContext/useDataContext';
import { useAppDispatch } from '../../hooks/store';

const LoginPage: React.FC = () => {
  const navigate = useNavigate();
  const dispatch = useAppDispatch();
  const { language } = useDataContext();

  const {
    register,
    handleSubmit,
    formState: { errors, isDirty, isValid },
  } = useForm<Form>({
    mode: 'onChange',
    resolver: yupResolver<Form>(schema),
  });

  const onSubmit: SubmitHandler<Form> = async (data) => {
    // const { name, email, password, passwordRepeat } = data;

    // if (!Object.values(data).includes(undefined))
    //   dispatch(
    //     setData({
    //       name,
    //       email,
    //       password,
    //       passwordRepeat,
    //     })
    //   );

    navigate(`/Welcome`);
  };

  return (
    <>
      <h2 className={styles['title']}>Login Page</h2>
      <div className={styles['form__container']}>
        <div className={styles['form']}>
          <form onSubmit={handleSubmit(onSubmit)}>
            <div className={styles['form-row']}>
              <div>
                <label htmlFor="name">name</label>
              </div>
              <div>
                <input type="text" {...register('name')} id="name" />
              </div>
            </div>
            {errors.name && (
              <p className={styles['error-message']} role="alert">
                {errorMessages.CHECK_NAME_FIRST_LETTER[language]}
              </p>
            )}

            <div className={styles['form-row']}>
              <label htmlFor="email">email</label>
              <input type="text" {...register('email')} id="email" />
            </div>
            {errors.email && (
              <p className={styles['error-message']} role="alert">
                {errors.email?.message}
              </p>
            )}

            <div className={styles['form-row']}>
              <label htmlFor="password">password</label>
              <input type="password" {...register('password')} id="password" />
            </div>
            {errors.password && (
              <p className={styles['error-message']} role="alert">
                {errors.password?.message}
              </p>
            )}

            <div className={styles['form-row']}>
              <label htmlFor="passwordRepeat">repeat password</label>
              <input
                type="password"
                {...register('passwordRepeat')}
                id="passwordRepeat"
              />
            </div>
            {errors.passwordRepeat && (
              <p className={styles['error-message']} role="alert">
                {errorMessages.CHECK_PASSWORD_MATCH[language]}
              </p>
            )}

            <div className={styles['form-row']}>
              <button type="submit" disabled={!isDirty || !isValid}>
                Login
              </button>
            </div>
          </form>
        </div>
      </div>
    </>
  );
};

export default LoginPage;
